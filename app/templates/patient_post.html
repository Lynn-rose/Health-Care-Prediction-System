<!DOCTYPE html>
<html>
    <head>
        <title>HCPS - Health Care Prediction System</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="static/css/styles.css">
    </head>
    <body >
        <div >
            <div class="w3-bar w3-white w3-card" id="myNavbar">
                <a href="/" class="w3-bar-item w3-button w3-wide">
                    <img src="images/logo-l.png" alt="logo" class='logo'>
                </a>
                <div class="w3-right w3-hide-small">
                    <a href="/" class="w3-bar-item w3-button"><i class="fa fa-home"></i> Home</a>
                    <a href="/dashboard" class="w3-bar-item w3-button"><i class="fa fa-desktop"></i> DEMO</a>
                    <a href="/#contact" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i> CONTACT</a>
                </div>
            </div>

            <div class="w3-container ">
                <div class='w3-white w3-card w3-padding w3-margin-bottom'>
                    
                <div class='w3-white w3-row-padding w3-center w3-card' style='width: 80%;'>
                    <div class="w3-center" style="text-align: center;">
                        <img class="w3-image w3-round-large" src="images/logo-l.png" alt="logo" width="300" height="200">
                    </div>
                    <h1>HCPS API</h1>
                    <div class='w3-half'>
                        <h2>Medical Data Form</h2>
                        <form id="medical-form">
                            <table>
                                <!-- Patient ID Input -->
                                <tr>
                                    <td style='text-align: left;'>Patient ID:</td>
                                    <td style='text-align: left;'><input type="text" name="patient_id" id="patient_id" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="text-align: right;">
                                        <input type="button" value="Get Data" class='w3-button w3-blue w3-padding-large w3-large w3-margin-top w3-hover-opacity' onclick="patient_post()">
                                    </td>
                                </tr>
                            </table>
                            <table>
                                <!-- Additional fields will be filled with fetched data -->
                                <tr>
                                    <td style='text-align: left;'>Name:</td>
                                    <td style='text-align: left;'><input type="text" name="name" id="name" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Age:</td>
                                    <td><input type="number" name="age" id="age" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Prescription:</td>
                                    <td style='text-align: left;'><input type="text" name="prescription" id="prescription" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Diagnosis:</td>
                                    <td style='text-align: left;'><input type="text" name="diagnosis" id="diagnosis" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Gender:</td>
                                    <td style='text-align: left;'><input type="text" name="gender" id="gender" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Race:</td>
                                    <td style='text-align: left;'><input type="text" name="race" id="race" style='width:100%' required></td>
                                </tr>
                                <!-- Similar dropdowns for admission_type, admission_location, insurance, marital_status, race -->
                                <!-- Fields for weight, bp_systolic, bp_diastolic -->
                                <tr>
                                    <td style='text-align: left;'>Admission Type:</td>
                                    <td style='text-align: left;'><input type="text" name="admission_type" id="admission_type" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Admission Location:</td>
                                    <td style='text-align: left;'><input type="text" name="admission_location" id="admission_location" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Insurance:</td>
                                    <td style='text-align: left;'><input type="text" name="insurance" id="insurance" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Marital Status:</td>
                                    <td style='text-align: left;'><input type="text" name="marital_status" id="marital_status" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>BP Systolic:</td>
                                    <td><input type="number" name="bp_systolic" id="bp_systolic" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>BP Diastolic:</td>
                                    <td><input type="number" name="bp_diastolic" id="bp_diastolic" style='width:100%' required></td>
                                </tr>
                                <tr>
                                    <td style='text-align: left;'>Weight:</td>
                                    <td><input type="number" name="weight" id="weight" style='width:100%' required></td>
                                </tr>
                                <tr>
                            </table>
                            <table>
                                <tr>
                                    <td colspan="2" style="text-align: right;">
                                        <input type="button" value="Submit" class='w3-button w3-green w3-padding-large w3-large w3-margin-top w3-hover-opacity' onclick="submitForm()">
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                    <div class='w3-half'>
                        <div id="result">
                            <!-- Predictions will be displayed here -->
                            <h2>Predictions</h2>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="w3-center w3-black w3-padding-64">
                <div class="w3-xlarge w3-section">
                    <i class="fa fa-facebook-official w3-hover-opacity"></i>
                    <i class="fa fa-instagram w3-hover-opacity"></i>
                    <i class="fa fa-twitter w3-hover-opacity"></i>
                    <i class="fa fa-github w3-hover-opacity"></i>
                </div>
                <p>Â© 2024 | HCPS - Health Care Prediction System. All rights reserved.</p>
            </footer>

            <script>
            
                async function patient_post() {
                    const patientId = document.getElementById('patient_id').value;
                
                    // Send a request to the backend with the patient_id
                    const response = await fetch(`/get_patient_data?patient_id=${patientId}`);
                    
                    if (response.ok) {
                        const data = await response.json();
                
                        // Fill the form with the received data
                        document.getElementById('name').value = data.name;
                        document.getElementById('age').value = data.age;
                        document.getElementById('prescription').value = data.drug;
                        document.getElementById('diagnosis').value = data.diagnosis;
                        document.getElementById('gender').value = data.gender;
                        document.getElementById('race').value = data.race;
                        document.getElementById('admission_type').value = data.type;
                        document.getElementById('admission_location').value = data.location;
                        document.getElementById('insurance').value = data.insurance;
                        document.getElementById('marital_status').value = data.maritalStatus;
                        document.getElementById('bp_systolic').value = data.bp_systolic;
                        document.getElementById('bp_diastolic').value = data.bp_diastolic;
                        document.getElementById('weight').value = data.weight;
                    } else {
                        alert("Patient not found");
                    }
                }

            async function submitForm() {
                const form = document.getElementById('medical-form');
                const formData = new FormData(form);
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                document.getElementById('result').innerHTML = `
                    <h3 class="w3-margin-bottom">Prediction Results:</h3>
                    <table class="w3-padding w3-large">
                        <tr>
                            <td style='text-align: left;' class="bold">Length of stay</td>
                            <td style='text-align: right';>${data.los} days</td>    
                        </tr>
                        <tr>
                            <td style='text-align: left;' class="bold">Readmission Likely</td>
                            <td>${data.readmission}</td>    
                        </tr>
                        <tr>
                            <td style='text-align: left;' class="bold">Adverse Case</td>
                            <td>${data.death}</td>    
                        </tr>
                    <table>
                `;
            }
            </script>
        </div>
    </body>
</html>
